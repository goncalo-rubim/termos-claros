<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <title>Termos Claros ‚Äì IA Jur√≠dica</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='25' fill='%2322c55e'/><text x='50' y='70' font-family='system-ui, sans-serif' font-weight='900' font-size='65' fill='%23020617' text-anchor='middle'>TC</text></svg>">
    
    <!-- Libs -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* --- DESIGN SYSTEM --- */
        :root {
            color-scheme: dark;
            --bg-deep: #020617;
            --surface-glass: rgba(15, 23, 42, 0.8);
            --border: rgba(148, 163, 184, 0.1);
            --accent: #22c55e;
            --accent-glow: rgba(34, 197, 94, 0.2);
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --radius: 16px;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; font-family: 'Outfit', sans-serif;
            background-color: var(--bg-deep);
            background-image: 
                radial-gradient(circle at 15% 15%, rgba(34, 197, 94, 0.08) 0%, transparent 45%),
                radial-gradient(circle at 85% 85%, rgba(56, 189, 248, 0.08) 0%, transparent 45%);
            color: var(--text-main);
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        /* HEADER */
        header { text-align: center; padding: 50px 20px 30px; max-width: 800px; animation: fadeIn 0.8s ease-out; }
        
        .logo-pill {
            display: inline-flex; align-items: center; gap: 8px;
            background: rgba(255, 255, 255, 0.03); border: 1px solid var(--border);
            padding: 6px 14px; border-radius: 99px; font-size: 12px; font-weight: 600;
            color: var(--accent); margin-bottom: 20px; backdrop-filter: blur(5px);
            box-shadow: 0 0 15px var(--accent-glow);
        }

        h1 { 
            margin: 0; 
            font-size: clamp(36px, 5vw, 48px); 
            letter-spacing: -1.5px; 
            line-height: 1.3; /* FOR√áADO A 1.3 */
            background: linear-gradient(to bottom right, #fff, #94a3b8); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        /* MAIN LAYOUT */
        .main-container {
            width: 100%; max-width: 1200px; padding: 0 20px;
            display: grid; grid-template-columns: 1fr 1fr; gap: 24px;
            margin-bottom: 40px; flex-grow: 1; align-items: start;
        }
        @media (max-width: 900px) { .main-container { grid-template-columns: 1fr; } }
        @media (min-width: 901px) { .glass-card:first-child { position: sticky; top: 30px; } }

        /* CARDS */
        .glass-card {
            background: var(--surface-glass); backdrop-filter: blur(20px);
            border: 1px solid var(--border); border-radius: var(--radius); padding: 24px;
            display: flex; flex-direction: column; min-height: 520px; 
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.5); transition: 0.3s;
        }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border); }
        .card-title { font-weight: 600; font-size: 16px; color: #fff; display: flex; gap: 8px; align-items: center; }

        /* TABS */
        .tabs { display: flex; gap: 8px; margin-bottom: 16px; }
        .tab-btn {
            background: rgba(255,255,255,0.03); border: 1px solid transparent; color: var(--text-muted);
            padding: 10px 16px; border-radius: 10px; font-size: 13px; cursor: pointer; flex: 1; transition: 0.2s; font-weight: 500;
        }
        .tab-btn.active { background: rgba(34, 197, 94, 0.1); color: #fff; border-color: var(--accent); }

        /* TEXTAREA (Improved) */
        textarea {
            width: 100%; background: rgba(0, 0, 0, 0.2); border: 1px solid var(--border);
            color: var(--text-main); border-radius: 12px; padding: 16px; font-size: 14px;
            flex-grow: 1; min-height: 200px; resize: none; line-height: 1.6; transition: 0.2s;
            font-family: 'JetBrains Mono', monospace;
        }
        textarea:focus { border-color: var(--accent); background: rgba(0, 0, 0, 0.4); outline: none; }
        textarea::placeholder { color: rgba(255, 255, 255, 0.2); }

        /* PDF DROP ZONE */
        .drop-zone {
            border: 2px dashed var(--border); border-radius: 12px; padding: 40px; text-align: center;
            background: rgba(0,0,0,0.2); cursor: pointer; transition: 0.2s; display: none;
            flex-grow: 1; align-items: center; justify-content: center; flex-direction: column;
        }
        .drop-zone.visible { display: flex; }
        .drop-zone:hover { border-color: var(--accent); background: rgba(34, 197, 94, 0.05); }
        .file-info { margin-top: 10px; font-size: 13px; color: var(--accent); font-weight: 600; }

        select {
            width: 100%; background: rgba(0, 0, 0, 0.3); border: 1px solid var(--border);
            color: var(--text-main); border-radius: 12px; padding: 12px; margin-top: 10px; font-family: inherit;
        }

        /* BUTTONS */
        .btn-primary {
            margin-top: 16px; width: 100%; padding: 14px; border: none; border-radius: 12px;
            background: linear-gradient(135deg, #22c55e, #15803d); color: #fff; font-weight: 600;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
            box-shadow: 0 10px 15px -3px rgba(34, 197, 94, 0.3); transition: 0.2s;
        }
        .btn-primary:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .btn-primary:disabled { opacity: 0.6; cursor: wait; transform: none; filter: grayscale(1); }

        .btn-text { background: none; border: none; color: var(--accent); font-size: 12px; cursor: pointer; padding: 6px 10px; border-radius: 6px; transition: 0.2s; }
        .btn-text:hover { background: rgba(34, 197, 94, 0.1); }

        .btn-icon { background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: var(--text-muted); padding: 6px 12px; border-radius: 8px; cursor: pointer; display: flex; gap: 6px; align-items: center; transition: 0.3s; }
        .btn-icon:hover { background: rgba(255,255,255,0.1); color: #fff; }
        
        .btn-icon.success { background: rgba(34, 197, 94, 0.2); color: var(--accent); border-color: var(--accent); }

        /* OUTPUT */
        .output-scroll { height: 100%; overflow-y: auto; padding-right: 6px; color: #e2e8f0; font-size: 15px; line-height: 1.7; }
        .output-scroll h2 { color: #fff; margin-top: 24px; font-size: 17px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 6px; }
        .output-scroll strong { color: var(--accent); }
        
        /* AVISO NO OUTPUT (O QUE PEDISTE) */
        /* O Backend envia isto como '>', o CSS transforma-o num bloco destacado */
        .output-scroll blockquote {
            background: rgba(234, 179, 8, 0.1); /* Fundo Amarelo Transparente */
            border-left: 4px solid #eab308; /* Barra Lateral Amarela */
            color: #fef08a; /* Texto Amarelo Claro */
            margin: 0 0 20px 0;
            padding: 16px;
            border-radius: 0 8px 8px 0;
            font-size: 13px;
            line-height: 1.6;
        }
        .output-scroll blockquote strong { color: #f59e0b; }

        /* Tabelas */
        .output-scroll table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 13px; background: rgba(0,0,0,0.2); border-radius: 8px; overflow: hidden; }
        .output-scroll th { text-align: left; padding: 12px; background: rgba(255,255,255,0.05); color: #fff; border-bottom: 1px solid var(--border); }
        .output-scroll td { padding: 12px; border-bottom: 1px solid var(--border); color: var(--text-muted); }

        /* STATUS */
        .status-wrapper { display: flex; flex-direction: column; align-items: center; gap: 10px; color: var(--text-muted); }
        .status-msg { font-size: 13px; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .spinner { width: 24px; height: 24px; border: 2px solid rgba(255,255,255,0.1); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* FOOTER SIMPLES */
        .simple-footer {
            width: 100%; padding: 30px 20px; border-top: 1px solid var(--border);
            text-align: center; color: #64748b; font-size: 13px; line-height: 1.6;
            background: #020617;
        }
    </style>
</head>
<body>

    <header>
        <div class="logo-pill">‚ú® Termos Claros AI</div>
        <h1>Traduz o "Legal√™s"<br>para Portugu√™s Claro.</h1>
    </header>

    <main class="main-container">
        <!-- INPUT -->
        <section class="glass-card">
            <div class="card-header">
                <span class="card-title"><i data-lucide="file-input" width="18"></i> 1. Documento</span>
                <button id="btnExample" class="btn-text">Exemplo</button>
            </div>

            <!-- TABS -->
            <div class="tabs">
                <button class="tab-btn active" onclick="setMode('text')">Colar Texto</button>
                <button class="tab-btn" onclick="setMode('pdf')">Upload PDF</button>
            </div>

            <!-- Text Input -->
            <textarea id="termsInput" placeholder="Cola aqui os Termos de Uso, Contrato ou Pol√≠tica de Privacidade..."></textarea>
            
            <!-- PDF Drop Zone -->
            <div id="dropZone" class="drop-zone">
                <i data-lucide="file-up" size="48" style="color:var(--text-muted); margin-bottom:10px;"></i>
                <p style="margin:0; color:var(--text-muted); font-size:14px;">Arrasta um ficheiro PDF ou clica aqui</p>
                <div id="fileInfo" class="file-info"></div>
                <input type="file" id="fileInput" accept=".pdf" style="display:none;">
            </div>

            <div style="margin-top:20px;">
                <label style="font-size:11px; text-transform:uppercase; color:rgba(255,255,255,0.5); font-weight:700;">Estilo do Resumo</label>
                <select id="styleSelect">
                    <option value="curto">Resumo Curto & Direto</option>
                    <option value="detalhado">Detalhado</option>
                    <option value="el5">Explicado a uma crian√ßa</option>
                    <option value="riscos">Apenas Riscos üö©</option>
                </select>
            </div>
            
            <button class="btn-primary" id="btnSummarize">
                <span>Analisar Documento</span> <i data-lucide="arrow-right" width="16"></i>
            </button>
        </section>

        <!-- OUTPUT -->
        <section class="glass-card">
            <div class="card-header">
                <span class="card-title"><i data-lucide="file-check" width="18"></i> Resultado</span>
                <button class="btn-icon" id="btnCopy">
                    <i data-lucide="copy" width="14"></i> <span id="copyLabel">Copiar</span>
                </button>
            </div>
            <div class="output-scroll" id="output">
                <div style="text-align:center; padding-top:100px; opacity:0.5;">
                    <i data-lucide="file-text" size="48"></i>
                    <p style="font-size:14px; margin-top:10px;">O resumo aparecer√° aqui.</p>
                </div>
            </div>
        </section>
    </main>

    <!-- FOOTER SIMPLES -->
    <footer class="simple-footer">
        Isen√ß√£o de Responsabilidade: Esta ferramenta utiliza Intelig√™ncia Artificial para processar informa√ß√£o.
        Embora o objetivo seja a precis√£o, podem ocorrer erros. O conte√∫do √© apenas informativo e 
        <strong>n√£o constitui aconselhamento jur√≠dico</strong>.
    </footer>

    <script>
        lucide.createIcons();
        let currentFile = null;
        let mode = 'text';

        // Tab Switching
        function setMode(newMode) {
            mode = newMode;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            if (mode === 'text') {
                document.getElementById('termsInput').style.display = 'block';
                document.getElementById('dropZone').classList.remove('visible');
            } else {
                document.getElementById('termsInput').style.display = 'none';
                document.getElementById('dropZone').classList.add('visible');
            }
        }

        // PDF Logic
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        
        dropZone.onclick = () => fileInput.click();
        
        fileInput.onchange = (e) => {
            if (e.target.files[0]) {
                currentFile = e.target.files[0];
                document.getElementById('fileInfo').innerText = "üìÑ " + currentFile.name;
                dropZone.style.borderColor = 'var(--accent)';
            }
        };

        dropZone.ondragover = (e) => { e.preventDefault(); dropZone.style.borderColor = 'var(--accent)'; };
        dropZone.ondrop = (e) => {
            e.preventDefault();
            if (e.dataTransfer.files[0]) {
                fileInput.files = e.dataTransfer.files;
                fileInput.dispatchEvent(new Event('change'));
            }
        };

        // Exemplo Realista
        document.getElementById('btnExample').onclick = () => {
            setMode('text');
            document.querySelectorAll('.tab-btn')[0].click();
            
            const text = `TERMOS DE SERVI√áO "FITNESS APP X" (EXEMPLO FICT√çCIO):
1. DADOS DE SA√öDE: Ao utilizar a app, o utilizador consente expressamente que os seus dados biom√©tricos (frequ√™ncia card√≠aca, peso, sono) e localiza√ß√£o GPS sejam partilhados com a "Seguradora Global Y" para fins de "ajuste de perfil de risco".
2. RENOVA√á√ÉO AUTOM√ÅTICA: A subscri√ß√£o Premium (19,99‚Ç¨/m√™s) renova-se automaticamente por per√≠odos de 12 meses. O cancelamento exige notifica√ß√£o por carta registada com 60 dias de anteced√™ncia.
3. ARBITRAGEM: O utilizador renuncia ao direito de participar em a√ß√µes coletivas ou recorrer aos tribunais civis, aceitando a arbitragem exclusiva no estado do Delaware, EUA.
4. CONTE√öDO: Todas as fotos de progresso carregadas na app tornam-se propriedade irrevog√°vel da "Fitness App X" para uso em campanhas de marketing globais.`;
            
            const el = document.getElementById('termsInput');
            el.value = "";
            let i = 0;
            const type = () => { 
                if(i<text.length) { 
                    el.value += text.charAt(i); 
                    i++; 
                    setTimeout(type, 2); 
                }
            };
            type();
        };

        // Update Status
        function updateStatus(msg) {
            document.getElementById('output').innerHTML = `
                <div style="display:flex; flex-direction:column; justify-content:center; align-items:center; height:100%; color:var(--text-muted); gap:15px;">
                    <div class="spinner"></div>
                    <div class="status-msg">${msg}</div>
                </div>
            `;
        }

        // Summarize
        document.getElementById('btnSummarize').onclick = async () => {
            const btn = document.getElementById('btnSummarize');
            const style = document.getElementById('styleSelect').value;
            const textVal = document.getElementById('termsInput').value;

            if (mode === 'text' && textVal.length < 5) return alert("Insere texto.");
            if (mode === 'pdf' && !currentFile) return alert("Escolhe um ficheiro.");

            btn.disabled = true;
            updateStatus("A iniciar...");

            try {
                const formData = new FormData();
                formData.append('style', style);
                
                if (mode === 'pdf') {
                    updateStatus("A extrair texto do PDF...");
                    formData.append('file', currentFile);
                } else {
                    formData.append('terms_text', textVal);
                }

                // Feedback visual de progresso
                setTimeout(() => updateStatus("A analisar riscos e cl√°usulas..."), 1500);
                setTimeout(() => updateStatus("A formatar o relat√≥rio..."), 3500);

                const res = await fetch('/api/summarize', { method: 'POST', body: formData });
                const data = await res.json();
                
                if (data.error) throw new Error(data.error);

                document.getElementById('output').innerHTML = DOMPurify.sanitize(marked.parse(data.summary));

            } catch (err) {
                document.getElementById('output').innerHTML = `<div style="color:#ef4444; text-align:center; padding-top:50px;">Erro: ${err.message}</div>`;
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span>Analisar Documento</span> <i data-lucide="arrow-right" width="16"></i>';
                lucide.createIcons();
            }
        };

        // Copiar Inteligente
        document.getElementById('btnCopy').onclick = () => {
            const text = document.getElementById('output').innerText;
            if(!text || text.includes("O resumo aparecer√° aqui")) return;

            navigator.clipboard.writeText(text).then(() => {
                const btn = document.getElementById('btnCopy');
                const label = document.getElementById('copyLabel');
                
                btn.classList.add('success');
                btn.innerHTML = `<i data-lucide="check" width="14"></i> Copiado!`;
                lucide.createIcons();

                setTimeout(() => {
                    btn.classList.remove('success');
                    btn.innerHTML = `<i data-lucide="copy" width="14"></i> Copiar`;
                    lucide.createIcons();
                }, 2000);
            });
        };
    </script>
</body>
</html>
