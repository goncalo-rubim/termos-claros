<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <title>Termos Claros | AI Legal</title>
    
    <!-- Fonts Premium -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Libs -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>

    <style>
        /* --- COSMIC THEME --- */
        :root {
            --bg: #030712;       /* Almost Black */
            --card: #111827;     /* Dark Grey */
            --input: #1f2937;
            --primary: #6366f1;  /* Indigo */
            --primary-glow: rgba(99, 102, 241, 0.5);
            --accent: #ec4899;   /* Pink */
            --text-main: #f9fafb;
            --text-muted: #9ca3af;
            --border: rgba(255,255,255,0.08);
            --radius: 16px;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg);
            color: var(--text-main);
            font-family: 'Outfit', sans-serif;
            margin: 0; min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            overflow-x: hidden;
            /* Background Glow Effect */
            background-image: 
                radial-gradient(circle at 15% 0%, rgba(99, 102, 241, 0.15), transparent 40%),
                radial-gradient(circle at 85% 100%, rgba(236, 72, 153, 0.1), transparent 40%);
        }

        /* HEADER */
        header { text-align: center; padding: 60px 20px 40px; max-width: 800px; animation: slideDown 0.8s ease-out; }
        
        .badge {
            display: inline-flex; align-items: center; gap: 6px;
            background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3);
            color: #a5b4fc; padding: 6px 12px; border-radius: 99px; font-size: 12px; font-weight: 600;
            margin-bottom: 20px; letter-spacing: 0.5px;
        }
        
        h1 {
            font-size: clamp(36px, 6vw, 52px); margin: 0; line-height: 1.1; font-weight: 700;
            background: linear-gradient(135deg, #fff 30%, #9ca3af 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .subtitle { color: var(--text-muted); font-size: 18px; margin-top: 16px; font-weight: 300; }

        /* MAIN CONTAINER */
        .container {
            width: 100%; max-width: 1000px; padding: 0 20px; display: grid; gap: 30px; margin-bottom: 60px;
        }

        /* CARD SYSTEM */
        .glass-card {
            background: rgba(17, 24, 39, 0.7); backdrop-filter: blur(20px);
            border: 1px solid var(--border); border-radius: var(--radius); padding: 32px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            position: relative; overflow: hidden; transition: 0.3s;
        }

        /* TABS */
        .tabs { display: flex; gap: 8px; margin-bottom: 24px; background: rgba(0,0,0,0.3); padding: 4px; border-radius: 12px; width: fit-content; }
        .tab-btn {
            background: transparent; border: none; color: var(--text-muted); padding: 8px 20px;
            border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: 0.2s;
        }
        .tab-btn.active { background: var(--input); color: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }

        /* INPUTS */
        textarea {
            width: 100%; min-height: 250px; background: var(--input); border: 1px solid var(--border);
            border-radius: 12px; padding: 20px; color: #fff; font-family: 'JetBrains Mono', monospace;
            font-size: 14px; line-height: 1.6; resize: none; transition: 0.2s;
        }
        textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2); }

        .drop-zone {
            border: 2px dashed var(--border); border-radius: 12px; padding: 60px 20px;
            text-align: center; cursor: pointer; background: rgba(255,255,255,0.02); transition: 0.2s;
            display: none; flex-direction: column; align-items: center; justify-content: center; gap: 12px;
        }
        .drop-zone:hover { border-color: var(--primary); background: rgba(99, 102, 241, 0.05); }
        .drop-zone.visible { display: flex; }

        /* CONTROLS GRID */
        .controls { display: grid; grid-template-columns: 1fr auto; gap: 20px; margin-top: 24px; align-items: end; }
        
        select {
            width: 100%; background: var(--input); color: #fff; border: 1px solid var(--border);
            padding: 14px; border-radius: 12px; cursor: pointer; font-family: inherit; font-size: 14px;
        }

        /* PRIMARY BUTTON */
        .btn-primary {
            background: var(--primary); color: #fff; border: none; padding: 14px 32px;
            border-radius: 12px; font-weight: 600; font-size: 16px; cursor: pointer;
            display: flex; align-items: center; gap: 10px; transition: 0.3s;
            box-shadow: 0 0 20px -5px var(--primary-glow);
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 0 30px -5px var(--primary-glow); }
        .btn-primary:disabled { opacity: 0.6; cursor: wait; transform: none; box-shadow: none; }

        /* MAGIC EXAMPLE BUTTON */
        .btn-magic {
            position: absolute; top: 32px; right: 32px;
            background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: var(--text-muted);
            padding: 8px 16px; border-radius: 20px; font-size: 12px; cursor: pointer;
            display: flex; align-items: center; gap: 6px; transition: 0.2s;
        }
        .btn-magic:hover { background: rgba(255,255,255,0.1); color: #fff; border-color: rgba(255,255,255,0.2); }

        /* LOADING STEPS */
        .loading-steps { display: none; margin-top: 20px; text-align: center; }
        .step { font-size: 14px; color: var(--text-muted); opacity: 0.5; margin: 4px 0; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .step.active { color: var(--primary); opacity: 1; font-weight: 500; }
        .step.done { color: #10b981; opacity: 0.8; }

        /* OUTPUT AREA */
        .output-area { display: none; animation: slideUp 0.6s ease; }
        .markdown-body { color: #e5e7eb; line-height: 1.8; font-size: 16px; }
        
        /* Typography Polish */
        .markdown-body h2 { color: #fff; border-bottom: 1px solid var(--border); padding-bottom: 10px; margin-top: 30px; font-weight: 600; }
        .markdown-body strong { color: #a5b4fc; font-weight: 600; }
        .markdown-body blockquote { border-left: 3px solid var(--accent); background: rgba(236, 72, 153, 0.1); margin: 20px 0; padding: 16px; border-radius: 0 8px 8px 0; font-style: italic; color: #fbcfe8; }
        
        /* Beautiful Tables */
        .markdown-body table { width: 100%; border-collapse: separate; border-spacing: 0; margin: 24px 0; border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
        .markdown-body th { background: rgba(255,255,255,0.05); color: #fff; padding: 14px; text-align: left; font-weight: 600; }
        .markdown-body td { padding: 14px; border-top: 1px solid var(--border); color: var(--text-muted); }

        /* Animations */
        @keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .spinner { width: 14px; height: 14px; border: 2px solid currentColor; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Footer */
        footer { margin-top: 40px; color: var(--text-muted); font-size: 12px; text-align: center; padding-bottom: 40px; }
    </style>
</head>
<body>

    <header>
        <div class="badge"><i data-lucide="sparkles" width="12"></i> SONAR PRO AI</div>
        <h1>Termos Claros</h1>
        <div class="subtitle">Traduz o "Legal√™s" para Portugu√™s Claro.</div>
    </header>

    <div class="container">
        
        <!-- INPUT CARD -->
        <div id="inputCard" class="glass-card">
            
            <button class="btn-magic" onclick="runMagicExample()">
                <i data-lucide="zap" width="12"></i> Exemplo Realista
            </button>

            <div class="tabs">
                <button class="tab-btn active" onclick="setMode('text')">Colar Texto</button>
                <button class="tab-btn" onclick="setMode('pdf')">Upload PDF</button>
            </div>

            <!-- Text Mode -->
            <textarea id="termsInput" placeholder="Cola aqui o contrato, termos de uso ou pol√≠tica de privacidade..."></textarea>
            
            <!-- PDF Mode -->
            <div id="dropZone" class="drop-zone">
                <i data-lucide="file-up" size="48" style="color:var(--text-muted); margin-bottom:8px;"></i>
                <p style="margin:0; color:var(--text-muted);">Arrasta o ficheiro PDF para aqui</p>
                <input type="file" id="fileInput" accept=".pdf" style="display:none;">
                <div id="fileName" style="color:var(--primary); font-size:14px; margin-top:8px;"></div>
            </div>

            <div class="controls">
                <div>
                    <label style="font-size:12px; color:var(--text-muted); font-weight:600; display:block; margin-bottom:8px; letter-spacing:0.5px;">ESTILO DA AN√ÅLISE</label>
                    <select id="styleSelect">
                        <option value="curto">Resumo Executivo (R√°pido)</option>
                        <option value="detalhado">Jur√≠dico Detalhado</option>
                        <option value="el5">Simplificado (Crian√ßa de 5 anos)</option>
                        <option value="riscos">Auditoria de Riscos üö©</option>
                    </select>
                </div>
                
                <button id="btnAnalyze" class="btn-primary" onclick="analyze()">
                    <span>Analisar Documento</span>
                    <i data-lucide="arrow-right" width="16"></i>
                </button>
            </div>

            <!-- Loading Steps -->
            <div id="loadingSteps" class="loading-steps">
                <div id="step1" class="step"><div class="spinner"></div> A ler documento...</div>
                <div id="step2" class="step">‚óã A detetar riscos...</div>
                <div id="step3" class="step">‚óã A formatar relat√≥rio...</div>
            </div>

        </div>

        <!-- OUTPUT CARD -->
        <div id="outputCard" class="glass-card output-area">
            <div style="display:flex; justify-content:space-between; margin-bottom:24px; border-bottom:1px solid var(--border); padding-bottom:16px;">
                <span style="font-weight:600; color:#fff; display:flex; align-items:center; gap:8px;">
                    <i data-lucide="file-check" width="18" style="color:var(--primary);"></i> Relat√≥rio Final
                </span>
                <button onclick="resetApp()" style="background:none; border:none; color:var(--text-muted); cursor:pointer; font-size:14px;">Nova An√°lise</button>
            </div>
            <div id="markdownOutput" class="markdown-body"></div>
        </div>

    </div>

    <footer>
        Nota Legal: Esta ferramenta utiliza IA para fins informativos. Consulte sempre um advogado.
    </footer>

    <script>
        lucide.createIcons();
        let currentFile = null;
        let mode = 'text';

        // TABS
        function setMode(newMode) {
            mode = newMode;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            if (mode === 'text') {
                document.getElementById('termsInput').style.display = 'block';
                document.getElementById('dropZone').classList.remove('visible');
            } else {
                document.getElementById('termsInput').style.display = 'none';
                document.getElementById('dropZone').classList.add('visible');
            }
        }

        // MAGIC EXAMPLE (Realistic Mock Contract)
        function runMagicExample() {
            setMode('text');
            const textarea = document.getElementById('termsInput');
            textarea.value = "";
            const text = `TERMOS DE SERVI√áO "FITNESS APP X" (EXEMPLO):
1. DADOS BIOM√âTRICOS: Ao utilizar a app, o utilizador consente que recolhamos dados de frequ√™ncia card√≠aca, sono e localiza√ß√£o GPS 24h/dia. Estes dados podem ser vendidos a "Parceiros de Seguros" para ajuste de pr√©mios de sa√∫de.
2. RENOVA√á√ÉO AUTOM√ÅTICA: A subscri√ß√£o Premium (19,99‚Ç¨/m√™s) renova-se automaticamente. O cancelamento exige o envio de carta registada com 30 dias de aviso pr√©vio.
3. ARBITRAGEM OBRIGAT√ìRIA: O utilizador renuncia ao direito de processar a Empresa em tribunal ou participar em a√ß√µes coletivas.
4. DIREITOS DE IMAGEM: Todas as fotos de progresso carregadas pertencem irrevogavelmente √† Empresa para uso em marketing.`;
            
            let i = 0;
            const type = () => { if(i<text.length) { textarea.value += text.charAt(i); i++; setTimeout(type, 5); } };
            type();
        }

        // PDF DROP
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        
        dropZone.onclick = () => fileInput.click();
        fileInput.onchange = (e) => handleFile(e.target.files[0]);
        dropZone.ondragover = (e) => { e.preventDefault(); dropZone.style.borderColor = 'var(--primary)'; };
        dropZone.ondrop = (e) => { e.preventDefault(); handleFile(e.dataTransfer.files[0]); };

        function handleFile(file) {
            if (!file) return;
            currentFile = file;
            document.getElementById('fileName').innerText = `üìÑ ${file.name}`;
            document.querySelector('.drop-zone i').style.color = 'var(--primary)';
        }

        // LOADING STEPS ANIMATION
        function updateStep(stepNum) {
            document.querySelectorAll('.step').forEach(s => {
                s.className = 'step'; 
                s.innerHTML = s.innerHTML.replace('<div class="spinner"></div>', '‚óã').replace('‚úì', '‚óã');
            });
            
            const current = document.getElementById(`step${stepNum}`);
            if(current) {
                current.className = 'step active';
                current.innerHTML = current.innerHTML.replace('‚óã', '<div class="spinner"></div>');
            }
            
            // Mark previous as done
            for(let i=1; i<stepNum; i++) {
                const prev = document.getElementById(`step${i}`);
                prev.className = 'step done';
                prev.innerHTML = prev.innerHTML.replace('<div class="spinner"></div>', '‚úì').replace('‚óã', '‚úì');
            }
        }

        // ANALYZE LOGIC
        async function analyze() {
            const btn = document.getElementById('btnAnalyze');
            const style = document.getElementById('styleSelect').value;
            const textVal = document.getElementById('termsInput').value;

            if (mode === 'text' && textVal.length < 5) return alert("Por favor insere texto.");
            if (mode === 'pdf' && !currentFile) return alert("Por favor carrega um PDF.");

            // Start UI
            btn.disabled = true;
            btn.style.opacity = '0'; // Hide button content effectively
            document.getElementById('loadingSteps').style.display = 'block';
            document.getElementById('outputCard').style.display = 'none';

            try {
                const formData = new FormData();
                formData.append('style', style);
                if (mode === 'pdf') formData.append('file', currentFile);
                else formData.append('terms_text', textVal);

                // Simulation of steps (for UX feel)
                updateStep(1);
                
                const fetchPromise = fetch('/api/summarize', { method: 'POST', body: formData });
                
                // Artificial delay to show step 2 (UX trick)
                setTimeout(() => updateStep(2), 1500);

                const res = await fetchPromise;
                
                updateStep(3);
                
                const data = await res.json();
                if (data.error) throw new Error(data.error);

                // Render
                setTimeout(() => {
                    document.getElementById('markdownOutput').innerHTML = DOMPurify.sanitize(marked.parse(data.summary));
                    document.getElementById('loadingSteps').style.display = 'none';
                    document.getElementById('outputCard').style.display = 'block';
                    btn.disabled = false;
                    btn.style.opacity = '1';
                    
                    // Smooth scroll to result
                    document.getElementById('outputCard').scrollIntoView({ behavior: 'smooth' });
                }, 800);

            } catch (err) {
                alert("Erro: " + err.message);
                btn.disabled = false;
                btn.style.opacity = '1';
                document.getElementById('loadingSteps').style.display = 'none';
            }
        }

        function resetApp() {
            document.getElementById('outputCard').style.display = 'none';
            document.getElementById('termsInput').value = '';
            document.getElementById('fileName').innerText = '';
            currentFile = null;
            document.getElementById('inputCard').scrollIntoView({ behavior: 'smooth' });
        }
        
        marked.use({ breaks: true });
    </script>
</body>
</html>
